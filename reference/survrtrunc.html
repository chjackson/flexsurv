<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Estimates the survivor function from right-truncated, uncensored data by
reversing time, interpreting the data as left-truncated, applying the
Kaplan-Meier / Lynden-Bell estimator and transforming back."><title>Nonparametric estimator of survival from right-truncated, uncensored data — survrtrunc • flexsurv</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Nonparametric estimator of survival from right-truncated, uncensored data — survrtrunc"><meta property="og:description" content="Estimates the survivor function from right-truncated, uncensored data by
reversing time, interpreting the data as left-truncated, applying the
Kaplan-Meier / Lynden-Bell estimator and transforming back."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">flexsurv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pdf.html">flexsurv PDF vignettes</a>
    <a class="dropdown-item" href="../articles/standsurv.html">Calculating standardized survival measures in flexsurv</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/chjackson/flexsurv/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Nonparametric estimator of survival from right-truncated, uncensored data</h1>
      <small class="dont-index">Source: <a href="https://github.com/chjackson/flexsurv/blob/HEAD/R/survrtrunc.R" class="external-link"><code>R/survrtrunc.R</code></a></small>
      <div class="d-none name"><code>survrtrunc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimates the survivor function from right-truncated, uncensored data by
reversing time, interpreting the data as left-truncated, applying the
Kaplan-Meier / Lynden-Bell estimator and transforming back.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">survrtrunc</span><span class="op">(</span><span class="va">t</span>, <span class="va">rtrunc</span>, <span class="va">tmax</span>, data <span class="op">=</span> <span class="cn">NULL</span>, eps <span class="op">=</span> <span class="fl">0.001</span>, conf.int <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>t</dt>
<dd><p>Vector of observed times from an initial event to a final event.</p></dd>


<dt>rtrunc</dt>
<dd><p>Individual-specific right truncation points, so that each
individual's survival time <code>t</code> would not have been observed if it was
greater than the corresponding element of <code>rtrunc</code>.   If any of these
are greater than <code>tmax</code>, then the actual individual-level truncation
point for these individuals is taken to be <code>tmax</code>.</p></dd>


<dt>tmax</dt>
<dd><p>Maximum possible time to event that could have been observed.</p></dd>


<dt>data</dt>
<dd><p>Data frame to find <code>t</code> and <code>rtrunc</code> in.  If not
supplied, these should be in the working environment.</p></dd>


<dt>eps</dt>
<dd><p>Small number that is added to <code>t</code> before implementing the
time-reversed estimator, to ensure the risk set is consistent between
forward and reverse time scales. It should be just large enough that
<code>t+eps</code> is not <code>==t</code>. This should not need changing from the
default of 0.001, unless <code>t</code> are extremely large or small and the
data are rounded to integer.</p></dd>


<dt>conf.int</dt>
<dd><p>Confidence level, defaulting to 0.95.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with components:</p>
<p></p>
<p><code>time</code> Time points where the estimated survival changes.</p>
<p></p>
<p><code>surv</code> Estimated survival at <code>time</code>, truncated above at</p>
<p></p>
<p><code>tmax</code>.</p>
<p></p>
<p><code>se.surv</code> Standard error of survival.</p>
<p></p>
<p><code>std.err</code> Standard error of -log(survival). Named this way for consistency with <code>survfit</code>.</p>
<p></p>
<p><code>lower</code> Lower confidence limits for survival.</p>
<p></p>
<p><code>upper</code> Upper confidence limits for survival.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that this does not estimate the untruncated survivor function - instead
it estimates the survivor function truncated above at a time defined by the
maximum possible time that might have been observed in the data.</p>


<p>Define \(X\) as the time of the initial event, \(Y\) as the time of the
final event, then we wish to determine the distribution of \(T = Y- X\).</p>
<p>Observations are only recorded if \(Y \leq t_{max}\).  Then the
distribution of \(T\) in the resulting sample is right-truncated by
<code>rtrunc</code> \( = t_{max} - X\).</p>
<p>Equivalently, the distribution of \(t_{max} - T\) is left-truncated, since
it is only observed if \(t_{max} - T \geq X\).  Then the standard
Kaplan-Meier type estimator as implemented in
<code><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></code> is used (as described by Lynden-Bell, 1971)
and the results transformed back.</p>
<p>This situation might happen in a disease epidemic, where \(X\) is the date
of disease onset for an individual, \(Y\) is the date of death, and we
wish to estimate the distribution of the time \(T\) from onset to death,
given we have only observed people who have died by the date \(t_{max}\).</p>
<p>If the estimated survival is unstable at the highest times, then consider
replacing <code>tmax</code> by a slightly lower value, then if necessary, removing
individuals with <code>t &gt; tmax</code>, so that the estimand is changed to the
survivor function truncated over a slightly narrower interval.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>D. Lynden-Bell (1971)  A method of allowing for known observational
selection in small samples applied to 3CR quasars. Monthly Notices of the
Royal Astronomical Society, 155:95–118.</p>
<p>Seaman, S., Presanis, A. and Jackson, C. (2020) Review of methods for
estimating distribution of time to event from right-truncated data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## simulate some event time data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">rweibull</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="cn">T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">rweibull</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## truncate above</span></span></span>
<span class="r-in"><span><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">20</span></span></span>
<span class="r-in"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">+</span> <span class="cn">T</span> <span class="op">&lt;</span> <span class="va">tmax</span></span></span>
<span class="r-in"><span><span class="va">rtrunc</span> <span class="op">&lt;-</span> <span class="va">tmax</span> <span class="op">-</span> <span class="va">X</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">X</span>, <span class="cn">T</span>, <span class="va">rtrunc</span><span class="op">)</span><span class="op">[</span><span class="va">obs</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">sf</span> <span class="op">&lt;-</span>    <span class="fu">survrtrunc</span><span class="op">(</span><span class="cn">T</span>, <span class="va">rtrunc</span>, data<span class="op">=</span><span class="va">dat</span>, tmax<span class="op">=</span><span class="va">tmax</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sf</span>, conf.int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Kaplan-Meier estimate ignoring truncation is biased</span></span></span>
<span class="r-in"><span><span class="va">sfnaive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="cn">T</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">sfnaive</span>, conf.int<span class="op">=</span><span class="cn">TRUE</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="survrtrunc-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## truncate above the maximum observed time</span></span></span>
<span class="r-in"><span><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">X</span> <span class="op">+</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">+</span> <span class="cn">T</span> <span class="op">&lt;</span> <span class="va">tmax</span></span></span>
<span class="r-in"><span><span class="va">rtrunc</span> <span class="op">&lt;-</span> <span class="va">tmax</span> <span class="op">-</span> <span class="va">X</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">X</span>, <span class="cn">T</span>, <span class="va">rtrunc</span><span class="op">)</span><span class="op">[</span><span class="va">obs</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">sf</span> <span class="op">&lt;-</span>    <span class="fu">survrtrunc</span><span class="op">(</span><span class="cn">T</span>, <span class="va">rtrunc</span>, data<span class="op">=</span><span class="va">dat</span>, tmax<span class="op">=</span><span class="va">tmax</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sf</span>, conf.int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## estimates identical to the standard Kaplan-Meier</span></span></span>
<span class="r-in"><span><span class="va">sfnaive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="cn">T</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">sfnaive</span>, conf.int<span class="op">=</span><span class="cn">TRUE</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="survrtrunc-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

