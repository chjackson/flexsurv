<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Expected total length of stay in specific states, from a fully-parametric, semi-Markov multi-state model — totlos.simfs • flexsurv</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Expected total length of stay in specific states, from a fully-parametric, semi-Markov multi-state model — totlos.simfs"><meta name="description" content="The expected total time spent in each state for semi-Markov multi-state
models fitted to time-to-event data with flexsurvreg.  This
is defined by the integral of the transition probability matrix, though
this is not analytically possible and is computed by simulation."><meta property="og:description" content="The expected total time spent in each state for semi-Markov multi-state
models fitted to time-to-event data with flexsurvreg.  This
is defined by the integral of the transition probability matrix, though
this is not analytically possible and is computed by simulation."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">flexsurv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/pdf.html">flexsurv PDF vignettes</a></li>
    <li><a class="dropdown-item" href="../articles/standsurv.html">Calculating standardized survival measures in flexsurv</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/chjackson/flexsurv/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Expected total length of stay in specific states, from a fully-parametric, semi-Markov multi-state model</h1>
      <small class="dont-index">Source: <a href="https://github.com/chjackson/flexsurv/blob/master/R/mstate.R" class="external-link"><code>R/mstate.R</code></a></small>
      <div class="d-none name"><code>totlos.simfs.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The expected total time spent in each state for semi-Markov multi-state
models fitted to time-to-event data with <code><a href="flexsurvreg.html">flexsurvreg</a></code>.  This
is defined by the integral of the transition probability matrix, though
this is not analytically possible and is computed by simulation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">totlos.simfs</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">trans</span>,</span>
<span>  t <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  start <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  newdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ci <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tvar <span class="op">=</span> <span class="st">"trans"</span>,</span>
<span>  tcovs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  M <span class="op">=</span> <span class="fl">1e+05</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  cl <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  cores <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A model fitted with <code><a href="flexsurvreg.html">flexsurvreg</a></code>.  See
<code><a href="msfit.flexsurvreg.html">msfit.flexsurvreg</a></code> for the required form of the model and the
data.  Additionally this should be semi-Markov, so that the time variable
represents the time since the last transition.  In other words the response
should be of the form <code>Surv(time,status)</code>. See the package vignette
for further explanation.</p>
<p><code>x</code> can also be a list of <code><a href="flexsurvreg.html">flexsurvreg</a></code> models,
with one component for each permitted transition, as illustrated
in <code><a href="msfit.flexsurvreg.html">msfit.flexsurvreg</a></code>.  This can be constructed by
<code><a href="fmsm.html">fmsm</a></code>.</p></dd>


<dt id="arg-trans">trans<a class="anchor" aria-label="anchor" href="#arg-trans"></a></dt>
<dd><p>Matrix indicating allowed transitions.  See
<code><a href="msfit.flexsurvreg.html">msfit.flexsurvreg</a></code>.  This is not required if <code>x</code>
is a list constructed by <code><a href="fmsm.html">fmsm</a></code>.</p></dd>


<dt id="arg-t">t<a class="anchor" aria-label="anchor" href="#arg-t"></a></dt>
<dd><p>Maximum time to predict to.</p></dd>


<dt id="arg-start">start<a class="anchor" aria-label="anchor" href="#arg-start"></a></dt>
<dd><p>Starting state.</p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p>A data frame specifying the values of covariates in the
fitted model, other than the transition number.  See
<code><a href="msfit.flexsurvreg.html">msfit.flexsurvreg</a></code>.</p></dd>


<dt id="arg-ci">ci<a class="anchor" aria-label="anchor" href="#arg-ci"></a></dt>
<dd><p>Return a confidence interval calculated by simulating from the
asymptotic normal distribution of the maximum likelihood estimates.  This
is turned off by default, since two levels of simulation are required.  If
turned on, users should adjust <code>B</code> and/or <code>M</code> until the results
reach the desired precision.  The simulation over <code>M</code> is generally
vectorised, therefore increasing <code>B</code> is usually more expensive than
increasing <code>M</code>.</p></dd>


<dt id="arg-tvar">tvar<a class="anchor" aria-label="anchor" href="#arg-tvar"></a></dt>
<dd><p>Variable in the data representing the transition type. Not
required if <code>x</code> is a list of models.</p></dd>


<dt id="arg-tcovs">tcovs<a class="anchor" aria-label="anchor" href="#arg-tcovs"></a></dt>
<dd><p>Predictable time-dependent covariates such as age, see
<code><a href="sim.fmsm.html">sim.fmsm</a></code>.</p></dd>


<dt id="arg-group">group<a class="anchor" aria-label="anchor" href="#arg-group"></a></dt>
<dd><p>Optional grouping for the states.  For example, if there are
four states, and <code>group=c(1,1,2,2)</code>, then <code>totlos.simfs</code>
returns the expected total time in states 1 and 2 combined, and states 3
and 4 combined.</p></dd>


<dt id="arg-m">M<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p>Number of individuals to simulate in order to approximate the
transition probabilities.  Users should adjust this to obtain the required
precision.</p></dd>


<dt id="arg-b">B<a class="anchor" aria-label="anchor" href="#arg-b"></a></dt>
<dd><p>Number of simulations from the normal asymptotic distribution used
to calculate confidence limits.  Decrease for greater speed at the expense of
accuracy.</p></dd>


<dt id="arg-cl">cl<a class="anchor" aria-label="anchor" href="#arg-cl"></a></dt>
<dd><p>Width of symmetric confidence intervals, relative to 1.</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>Number of processor cores used when calculating confidence
limits by repeated simulation.  The default uses single-core processing.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The expected total time spent in each state (or group of states
given by <code>group</code>) up to time <code>t</code>, and corresponding confidence
intervals if requested.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This is computed by simulating a large number of individuals <code>M</code> using
the maximum likelihood estimates of the fitted model and the function
<code><a href="sim.fmsm.html">sim.fmsm</a></code>.  Therefore this requires a random sampling function
for the parametric survival model to be available: see the "Details"
section of <code><a href="sim.fmsm.html">sim.fmsm</a></code>.  This will be available for all built-in
distributions, though users may need to write this for custom models.</p>
<p>Note the random sampling method for <code>flexsurvspline</code> models is
currently very inefficient, so that looping over <code>M</code> will be very
slow.</p>
<p>The equivalent function for time-inhomogeneous Markov models is
<code><a href="totlos.fs.html">totlos.fs</a></code>.  Note neither of these functions give errors or
warnings if used with the wrong type of model, but the results will be
invalid.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="pmatrix.simfs.html">pmatrix.simfs</a></code>,<code><a href="sim.fmsm.html">sim.fmsm</a></code>,<code><a href="msfit.flexsurvreg.html">msfit.flexsurvreg</a></code>.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Christopher Jackson <a href="mailto:chris.jackson@mrc-bsu.cam.ac.uk">chris.jackson@mrc-bsu.cam.ac.uk</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># BOS example in vignette, and in msfit.flexsurvreg</span></span></span>
<span class="r-in"><span><span class="va">bexp</span> <span class="op">&lt;-</span> <span class="fu"><a href="flexsurvreg.html">flexsurvreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">years</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">trans</span>, data<span class="op">=</span><span class="va">bosms3</span>, dist<span class="op">=</span><span class="st">"exp"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="cn">NA</span>,<span class="fl">3</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># predict 4 years spent without BOS, 3 years with BOS, before death</span></span></span>
<span class="r-in"><span><span class="co"># As t increases, this should converge</span></span></span>
<span class="r-in"><span><span class="fu">totlos.simfs</span><span class="op">(</span><span class="va">bexp</span>, t<span class="op">=</span><span class="fl">10</span>, trans<span class="op">=</span><span class="va">tmat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1        2        3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3.744539 2.125464 4.129996 </span>
<span class="r-in"><span><span class="fu">totlos.simfs</span><span class="op">(</span><span class="va">bexp</span>, t<span class="op">=</span><span class="fl">1000</span>, trans<span class="op">=</span><span class="va">tmat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1          2          3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4.127571   2.957678 992.914751 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

