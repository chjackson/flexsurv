<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Flexible parametric mixture models for times to competing events — flexsurvmix • flexsurv</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Flexible parametric mixture models for times to competing events — flexsurvmix"><meta name="description" content="In a mixture model for competing events, an individual can experience one of
a set of different events.  We specify a model for the probability that they
will experience each event before the others, and a model for the time to
the event conditionally on that event occurring first."><meta property="og:description" content="In a mixture model for competing events, an individual can experience one of
a set of different events.  We specify a model for the probability that they
will experience each event before the others, and a model for the time to
the event conditionally on that event occurring first."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">flexsurv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/pdf.html">flexsurv PDF vignettes</a></li>
    <li><a class="dropdown-item" href="../articles/standsurv.html">Calculating standardized survival measures in flexsurv</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/chjackson/flexsurv/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Flexible parametric mixture models for times to competing events</h1>
      <small class="dont-index">Source: <a href="https://github.com/chjackson/flexsurv/blob/master/R/flexsurvmix.R" class="external-link"><code>R/flexsurvmix.R</code></a></small>
      <div class="d-none name"><code>flexsurvmix.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>In a mixture model for competing events, an individual can experience one of
a set of different events.  We specify a model for the probability that they
will experience each event before the others, and a model for the time to
the event conditionally on that event occurring first.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">flexsurvmix</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">event</span>,</span>
<span>  <span class="va">dists</span>,</span>
<span>  pformula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  anc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  partial_events <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  initp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  inits <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fixedpars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dfns <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"direct"</span>,</span>
<span>  em.control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  optim.control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  aux <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sr.control <span class="op">=</span> <span class="fu">survreg.control</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">integ.opts</span>,</span>
<span>  hess.control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>Survival model formula.  The left hand side is a <code>Surv</code>
  object specified as in <code><a href="flexsurvreg.html">flexsurvreg</a></code>.  This may define various
  kinds of censoring, as described in <code><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></code>. Any covariates on
  the right hand side of this formula will be placed on the location
  parameter for every component-specific distribution. Covariates on other
  parameters of the component-specific distributions may be supplied  using
  the <code>anc</code> argument.</p>
<p>Alternatively, <code>formula</code> may be a list of formulae, with one
  component for each alternative event.  This may be used to specify
  different covariates on the location parameter for different components.</p>
<p>A list of formulae may also be used to indicate that for particular
  individuals, different events may be observed in different ways, with
  different censoring mechanisms.  Each  list component specifies the data
  and censoring scheme for that mixture component.</p>
<p>For example, suppose we are studying people admitted to hospital,and the
  competing states are death in hospital and discharge from hospital.  At
  time t we know that a particular individual is still alive, but we do not
  know whether they are still in hospital, or have been discharged.  In this
  case, if the individual were to die in hospital, their death time would be
  right censored at t.  If the individual will be (or has been) discharged
  before death, their discharge time is completely unknown, thus
  interval-censored on (0,Inf). Therefore,  we need to store different event
  time and status variables in the data for different alternative events.
  This is specified here as</p>
<p><code>formula = list("discharge" = Surv(t1di, t2di, type="interval2"),
  "death" = Surv(t1de, status_de))</code></p>
<p>where for this individual, <code>(t1di, t2di) = (0, Inf)</code> and <code>(t1de,
  status_de)  = (t, 0)</code>.</p>
<p>The "dot" notation commonly used to indicate "all remaining variables" in a
  formula is not supported in <code>flexsurvmix</code>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame containing variables mentioned in <code>formula</code>,
<code>event</code> and <code>anc</code>.</p></dd>


<dt id="arg-event">event<a class="anchor" aria-label="anchor" href="#arg-event"></a></dt>
<dd><p>Variable in the data that specifies which of the alternative
  events is observed for which individual.  If the individual's follow-up is
  right-censored, or if the event is otherwise unknown, this variable must
  have the value <code>NA</code>.</p>
<p>Ideally this should be a factor, since the mixture components can then be
  easily identified in the results with a name instead of a number.  If this
  is not already a factor, it is coerced to one.   Then the levels of the
  factor define the required order for the components of the list arguments
  <code>dists</code>, <code>anc</code>, <code>inits</code> and <code>dfns</code>.  Alternatively, if
  the components of the list arguments are named according to the levels of
  <code>event</code>, then the components can be arranged in any order.</p></dd>


<dt id="arg-dists">dists<a class="anchor" aria-label="anchor" href="#arg-dists"></a></dt>
<dd><p>Vector specifying the parametric distribution to use for each
component. The same distributions are supported as in
<code><a href="flexsurvreg.html">flexsurvreg</a></code>.</p></dd>


<dt id="arg-pformula">pformula<a class="anchor" aria-label="anchor" href="#arg-pformula"></a></dt>
<dd><p>Formula describing covariates to include on the component
membership proabilities by multinomial logistic regression.  The first
component is treated as the baseline.</p>
<p>The "dot" notation commonly used to indicate "all remaining variables" in a
formula is not supported.</p></dd>


<dt id="arg-anc">anc<a class="anchor" aria-label="anchor" href="#arg-anc"></a></dt>
<dd><p>List of component-specific lists, of length equal to the number
  of components.   Each component-specific list is a list of formulae
  representing covariate effects on parameters of the distribution.</p>
<p>If there are covariates for one component but not others, then a list
  containing one null formula on the location parameter should be supplied
  for the component with no covariates, e.g <code>list(rate=~1)</code> if the
  location parameter is called <code>rate</code>.</p>
<p>Covariates on the location parameter may also be supplied here instead of
  in <code>formula</code>.  Supplying them in <code>anc</code> allows some components
  but not others to have covariates on their location parameter.  If a covariate
  on the location parameter was provided in <code>formula</code>, and there are
  covariates on other parameters, then a null formula should be included
  for the location parameter in <code>anc</code>, e.g <code>list(rate=~1)</code></p></dd>


<dt id="arg-partial-events">partial_events<a class="anchor" aria-label="anchor" href="#arg-partial-events"></a></dt>
<dd><p>List specifying the factor levels of <code>event</code>
  which indicate knowledge that an individual will not experience particular
  events, but may experience others.   The names of the list indicate codes
  that indicate partial knowledge for some individuals.  The list component
  is a vector, which must be a subset of <code>levels(event)</code> defining the
  events that a person with the corresponding event code may experience.</p>
<p>For example, suppose there are three alternative events called
  <code>"disease1"</code>,<code>"disease2"</code> and <code>"disease3"</code>, and for some
  individuals we know that they will not experience <code>"disease2"</code>, but
  they may experience the other two events.  In that case we must create a
  new factor level, called, for example <code>"disease1or3"</code>, and set the
  value of <code>event</code> to be <code>"disease1or3"</code> for those individuals.
  Then we use the <code>"partial_events"</code> argument to tell
  <code>flexsurvmix</code> what the potential events are for individuals with this
  new factor level.</p>
<p><code>partial_events = list("disease1or3" = c("disease1","disease3"))</code></p></dd>


<dt id="arg-initp">initp<a class="anchor" aria-label="anchor" href="#arg-initp"></a></dt>
<dd><p>Initial values for component membership probabilities.  By
default, these are assumed to be equal for each component.</p></dd>


<dt id="arg-inits">inits<a class="anchor" aria-label="anchor" href="#arg-inits"></a></dt>
<dd><p>List of component-specific vectors. Each component-specific
vector contains the initial values for the parameters of the
component-specific model, as would be supplied as the <code>inits</code> argument of
<code><a href="flexsurvreg.html">flexsurvreg</a></code>.   By default, a heuristic is used to obtain
initial values, which depends on the parametric distribution being used,
but is usually based on the empirical mean and/or variance of the survival
times.</p></dd>


<dt id="arg-fixedpars">fixedpars<a class="anchor" aria-label="anchor" href="#arg-fixedpars"></a></dt>
<dd><p>Indexes of parameters to fix at their initial values and
  not optimise. Arranged in the order: baseline mixing probabilities,
  covariates on mixing probabilities, time-to-event parameters by mixing
  component.  Within mixing components, time-to-event parameters are ordered
  in the same way as in <code><a href="flexsurvreg.html">flexsurvreg</a></code>.</p>
<p>If <code>fixedpars=TRUE</code> then all parameters will be fixed and the
  function simply calculates the log-likelihood at the initial values.</p>
<p>Not currently supported when using the EM algorithm.</p></dd>


<dt id="arg-dfns">dfns<a class="anchor" aria-label="anchor" href="#arg-dfns"></a></dt>
<dd><p>List of lists of user-defined distribution functions, one for
each mixture component.  Each list component is specified as the
<code>dfns</code> argument of <code><a href="flexsurvreg.html">flexsurvreg</a></code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Method for maximising the likelihood.  Either <code>"em"</code> for
the EM algorithm, or <code>"direct"</code> for direct maximisation.</p></dd>


<dt id="arg-em-control">em.control<a class="anchor" aria-label="anchor" href="#arg-em-control"></a></dt>
<dd><p>List of settings to control EM algorithm fitting.  The
  only options currently available are</p>
<p><code>trace</code> set to 1 to print the parameter estimates at each iteration
  of the EM algorithm</p>
<p><code>reltol</code> convergence criterion.  The algorithm stops if the log
  likelihood changes by a relative amount less than <code>reltol</code>.  The
  default is the same as in <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>, that is,
  <code>sqrt(.Machine$double.eps)</code>.</p>
<p><code>var.method</code> method to compute the covariance matrix. <code>"louis"</code>
  for the method of Louis (1982), or <code>"direct"</code>for direct numerical
  calculation of the Hessian of the log likelihood.</p>
<p><code>optim.p.control</code> A list that is passed as the <code>control</code>
  argument to  <code>optim</code> in the M step for the component membership
  probability parameters. The optimisation in the M step for the
  time-to-event parameters can be controlled by the <code>optim.control</code>
  argument to <code>flexsurvmix</code>.</p>
<p>For example, <code>em.control = list(trace=1, reltol=1e-12)</code>.</p></dd>


<dt id="arg-optim-control">optim.control<a class="anchor" aria-label="anchor" href="#arg-optim-control"></a></dt>
<dd><p>List of options to pass as the <code>control</code> argument
to <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>,  which is used by <code>method="direct"</code> or in the
M step for the time-to-event parameters in <code>method="em"</code>.  By
default, this uses <code>fnscale=10000</code> and <code>ndeps=rep(1e-06,p)</code>
where <code>p</code> is the number of parameters being estimated, unless the
user specifies these options explicitly.</p></dd>


<dt id="arg-aux">aux<a class="anchor" aria-label="anchor" href="#arg-aux"></a></dt>
<dd><p>A named list of other arguments to pass to custom distribution
functions.  This is used, for example, by <code><a href="flexsurvspline.html">flexsurvspline</a></code> to
supply the knot locations and modelling scale (e.g. hazard or odds).  This
cannot be used to fix parameters of a distribution — use
<code>fixedpars</code> for that.</p></dd>


<dt id="arg-sr-control">sr.control<a class="anchor" aria-label="anchor" href="#arg-sr-control"></a></dt>
<dd><p>For the models which use <code><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survreg</a></code> to find the
maximum likelihood estimates (Weibull, exponential, log-normal), this list
is passed as the <code>control</code> argument to <code><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survreg</a></code>.</p></dd>


<dt id="arg-integ-opts">integ.opts<a class="anchor" aria-label="anchor" href="#arg-integ-opts"></a></dt>
<dd><p>List of named arguments to pass to
  <code><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></code>, if a custom density or hazard is provided without
  its cumulative version.  For example,</p>
<p><code>integ.opts = list(rel.tol=1e-12)</code></p></dd>


<dt id="arg-hess-control">hess.control<a class="anchor" aria-label="anchor" href="#arg-hess-control"></a></dt>
<dd><p>List of options to control covariance matrix computation.
   Available options are:</p>
<p><code>numeric</code>.  If <code>TRUE</code> then numerical methods are used
  to compute the Hessian for models where an analytic Hessian is
  available.  These models include the Weibull (both versions),
  exponential, Gompertz and spline models with hazard or odds
  scale.  The default is to use the analytic Hessian for these
  models.  For all other models, numerical methods are always used
  to compute the Hessian, whether or not this option is set.</p>
<p><code>tol.solve</code>. The tolerance used for <code><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></code>
  when inverting the Hessian (default <code>.Machine$double.eps</code>)</p>
<p><code>tol.evalues</code> The accepted tolerance for negative
  eigenvalues in the covariance matrix (default <code>1e-05</code>).</p>
<p>The Hessian is positive definite, thus invertible, at the maximum
  likelihood.  If the Hessian computed after optimisation convergence can't
  be inverted, this is either because the converged result is not the
  maximum likelihood (e.g. it could be a "saddle point"), or because the
  numerical methods used to obtain the Hessian were inaccurate. If you
  suspect that the Hessian was computed wrongly enough that it is not
  invertible, but not wrongly enough that the nearest valid inverse would be
  an inaccurate estimate of the covariance matrix, then these tolerance
  values can be modified (reducing <code>tol.solve</code> or increasing
  <code>tol.evalues</code>) to allow the inverse to be computed.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Optional arguments to the general-purpose optimisation routine
<code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>.  For example, the BFGS optimisation algorithm is the
default in <code><a href="flexsurvreg.html">flexsurvreg</a></code>, but this can be changed, for example
to <code>method="Nelder-Mead"</code> which can be more robust to poor initial
values.  If the optimisation fails to converge, consider normalising the
problem using, for example, <code>control=list(fnscale = 2500)</code>, for
example, replacing 2500 by a number of the order of magnitude of the
likelihood. If 'false' convergence is reported with a
non-positive-definite Hessian, then consider tightening the tolerance
criteria for convergence. If the optimisation takes a long time,
intermediate steps can be printed using the <code>trace</code> argument of the
control list. See <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code> for details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>List of objects containing information about the fitted model.   The
  important one is <code>res</code>, a data frame containing the parameter
  estimates and associated information.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This differs from the more usual "competing risks" models, where we specify
"cause-specific hazards" describing the time to each competing event.  This
time will not be observed for an individual if one of the competing events
happens first.  The event that happens first is defined by the minimum of
the times to the alternative events.</p>
<p>The <code>flexsurvmix</code> function fits a mixture model to data consisting of a
single time to an event for each individual, and an indicator for what type
of event occurs for that individual.   The time to event may be observed or
censored, just as in <code><a href="flexsurvreg.html">flexsurvreg</a></code>, and the type of event may be
known or unknown. In a typical application, where we follow up a set of
individuals until they experience an event or a maximum follow-up time is
reached, the event type is known if the time is observed, and the event type
is unknown when follow-up ends and the time is right-censored.</p>
<p>The model is fitted by maximum likelihood, either directly or by using an
expectation-maximisation (EM) algorithm, by wrapping
<code><a href="flexsurvreg.html">flexsurvreg</a></code> to compute the likelihood or to implement the E
and M steps.</p>
<p>Some worked examples are given in the package vignette about multi-state
modelling, which can be viewed by running <code>vignette("multistate", package="flexsurv")</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Jackson, C. H. and Tom, B. D. M. and Kirwan, P. D. and Mandal, S.
and Seaman, S. R. and Kunzmann, K. and Presanis, A. M. and De Angelis, D. (2022)
A comparison of two frameworks for multi-state modelling, applied to outcomes
after hospital admissions with COVID-19.  Statistical Methods in Medical Research
31(9) 1656-1674.</p>
<p>Larson, M. G., &amp; Dinse, G. E. (1985). A mixture model for the
  regression analysis of competing risks data. Journal of the Royal
  Statistical Society: Series C (Applied Statistics), 34(3), 201-211.</p>
<p>Lau, B., Cole, S. R., &amp; Gange, S. J. (2009). Competing risk regression
  models for epidemiologic data. American Journal of Epidemiology, 170(2),
  244-256.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

